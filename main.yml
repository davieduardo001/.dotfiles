---
  - name: Prepare the workstation
    hosts: localhost
    connection: local

    tasks:
      # INSTALL PACMAN APPS
      - name: Installing with pacman
        block:
          - name: loop for instalation
            pacman:
              name: '{{ item }}'
              state: present
            loop:
              - lf
              - base-devel
              - curl
              - kitty
              - syncthing
              - python-pip
              - fish
              - vim
      
      # install JetBrainsMono
      - name: install JetBrainsMono
        block:
          - name: Find JetBrainsMono fonts
            find:
              paths: '{{ ansible_user_dir }}/.local/share/fonts/'
              patterns: 'JetBrainsMono*'
            register: font_found

          - name: Ensure fonts directory exists
            file:
              path: '{{ ansible_user_dir }}/.local/share/fonts'
              state: directory
              mode: '0755'

          - name: Download JetBrainsMono zip
            get_url:
              url: https://github.com/ryanoasis/nerd-fonts/releases/download/v3.2.1/JetBrainsMono.zip
              dest: /tmp/JetBrainsMono.zip
            when: font_found.matched == 0

          - name: Unzip JetBrainsMono fonts
            command: unzip /tmp/JetBrainsMono.zip -d {{ ansible_user_dir }}/.local/share/fonts/
            when: font_found.matched == 0

          - name: Update font cache
            command: fc-cache -fv
            when: font_found.matched == 0

      # config kitty
      - name: Config the terminal
        block:
          - name: create or cleanup the kitty file
            file: 
              path: '{{ ansible_user_dir }}/.config/kitty'
              state: directory
          
          - name: create the link to the config file
            command: >
              ln '{{ ansible_user_dir }}/.dotfiles/dotfiles/kitty/kitty.conf' '{{ ansible_user_dir }}/.config/kitty/kitty.conf'
          
          - name: create the link to the theme file
            command: >
              ln '{{ ansible_user_dir }}/.dotfiles/dotfiles/kitty/theme.conf' '{{ ansible_user_dir }}/.config/kitty/theme.conf'
